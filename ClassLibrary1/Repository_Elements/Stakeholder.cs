///////////////////////////////////////////////////////////
//  Stakeholder.cs
//  Implementation of the Class Stakeholder
//  Generated by Enterprise Architect
//  Created on:      23-Jan-2019 17:22:14
//  Original author: Yannick
///////////////////////////////////////////////////////////

using System;
using System.Collections.Generic;
using System.Text;
using System.IO;
using System.Data.OleDb;
using Requirement_Plugin.Interfaces;
using System.Data.Odbc;

using Database_Connection;
using Elements;
using Ennumerationen;

using Requirement_Plugin;
using Metamodels;

namespace Repsoitory_Elements
{
	public class Stakeholder : Repository_Class
    {

		public List<Stakeholder> m_Child;
		public List<Element_User> m_Element_User;
		public Stakeholder Parent;
        public List<NodeType> m_Realisation;
        

        ////////Require7 Attribute
        public string UUID;
        public string OBJECT_ID;
        public string st_AG_ID;
        public string st_AN_ID;
        public string st_STAKEHOLDER;
        public string st_BESCHREIBUNG;
        public string st_ARTIKEL;
        public string st_WV_PHASE;
        public string st_GRUPPE;
        public string in_CATEGORY;
        public string st_AKTEUR_TYP;
        public string st_ANSPRECHPARTNER;
        public string st_WISSENSGEBIET;
        public string st_INTERESSE;
        public string st_EINFLUSS;
        public string w_NUTZENDER { get; set; }

        public Stakeholder(string GUID, EA.Repository Repository, Database Data){

            

            this.Classifier_ID = GUID;
            this.ID = this.Get_Object_ID(Data);
            this.Author = this.Get_Author(Data);
            this.Name = this.Get_Name(Data);
            this.Notes = this.Get_Notes(Data);
            this.m_Child = new List<Stakeholder>();
            this.Parent = null;
            this.m_Element_User = new List<Element_User>();
            this.m_Realisation = new List<NodeType>();
            

            if(this.Classifier_ID != null)
            {
                this.st_GRUPPE = Data.metamodel.m_Stakeholder_Definition[0].XAC_Attribut;
              
                this.Get_TV(Data, Repository);
            }
           
        }

        ~Stakeholder(){

		}

        private void Get_TV(Database Data, EA.Repository Repository)
        {
            TV_Map help;
            TaggedValue tagged = new TaggedValue(Data.metamodel, Data);
            List<DB_Insert> m_Insert = new List<DB_Insert>();
          //  string SQL = "SELECT Value, Notes FROM t_objectproperties WHERE Property = ? AND Object_ID = ?";
           // string[] output = { "Value", "Notes" };

         //   OleDbCommand oleDbCommand = new OleDbCommand(SQL, Data.oLEDB_Interface.dbConnection);
         //   List<DB_Return> m_TV = Data.oLEDB_Interface.oleDB_SELECT_One_Table_Multiple_Property(oleDbCommand, output, Data.metamodel.ST_Tagged_Values, this.ID);

            Interface_TaggedValue interface_TaggedValue = new Interface_TaggedValue();
            List<DB_Return> m_TV = interface_TaggedValue.Get_Tagged_Value(Data.metamodel.ST_Tagged_Values, this.ID, Data);

            if (m_TV != null)
            {
                string Value = "";
                string Note = "";
                string insert = "";
                bool flag_insert = false;
                string recent = "";
                int i1 = 0;
                do
                {
                    if (m_TV[i1].Ret.Count > 1)
                    {
                        if (m_TV[i1].Ret[1] == null && m_TV[i1].Ret[2] == null)
                        {
                            flag_insert = true;
                        }
                        /*    if (m_TV[i1].Ret[1] == "" && m_TV[i1].Ret[2] == "")
                            {
                                flag_insert = true;
                            }*/
                        else
                        {
                            flag_insert = false;
                            if (m_TV[i1].Ret[1].ToString() != "<memo>")
                            {
                                recent = (string)m_TV[i1].Ret[1];
                            }
                            else
                            {
                                recent = (string)m_TV[i1].Ret[2];
                            }

                            #region Zuweisung Attribute
                            switch ((string)m_TV[i1].Ret[0])
                            {
                                case "UUID":
                                    this.UUID = recent;
                                    break;
                                case "OBJECT_ID":
                                    this.OBJECT_ID = recent;
                                    break;
                                case "ST_AG_ID":
                                    this.st_AG_ID = recent;
                                    break;
                                case "ST_AN_ID":
                                    this.st_AN_ID = recent;
                                    break;
                                case "ST_STAKEHOLDER":
                                    this.st_STAKEHOLDER = recent;
                                    this.Name = recent;
                                    break;
                                case "W_NUTZENDER":
                                    this.w_NUTZENDER = recent;
                                    break;
                                case "ST_BESCHREIBUNG":
                                    this.st_BESCHREIBUNG = recent;
                                    break;
                                case "ST_ARTIKEL":
                                    this.st_ARTIKEL = recent;
                                    break;
                                case "ST_WV_PHASE":
                                    help = Data.metamodel.ST_Tagged_Values.Find(x => x.Name == "ST_WV_PHASE");
                                    if (recent != help.Default_Value)
                                    {
                                        this.st_WV_PHASE = recent;
                                    }
                                    else
                                    {
                                        this.st_WV_PHASE = Data.ST_ENUM.ST_WV_PHASE[0];
                                    }
                                      break;
                                case "ST_GRUPPE":
                                    help = Data.metamodel.ST_Tagged_Values.Find(x => x.Name == "ST_GRUPPE");
                                    if (recent != help.Default_Value)
                                    {
                                        this.st_GRUPPE = recent;
                                    }
                                    else
                                    {
                                        this.st_GRUPPE = Data.ST_ENUM.ST_GRUPPE[0];
                                    }
                                    break;
                                case "IN_CATEGORY":
                                    help = Data.metamodel.AFO_Tagged_Values.Find(x => x.Name == "IN_CATEGORY");
                                    if (recent != help.Default_Value)
                                    {
                                        this.in_CATEGORY = recent;
                                    }
                                    else
                                    {
                                        this.in_CATEGORY = Data.AFO_ENUM.IN_CATEGORY[0];
                                    }
                               
                                    break;
                                case "ST_AKTEUR_TYP":
                                    help = Data.metamodel.ST_Tagged_Values.Find(x => x.Name == "ST_AKTEUR_TYP");
                                    if (recent != help.Default_Value)
                                    {
                                        this.st_AKTEUR_TYP = recent;
                                    }
                                    else
                                    {
                                        this.st_AKTEUR_TYP = Data.ST_ENUM.ST_AKTEUR_TYP[0];
                                    }
                                    break;
                                case "ST_ANSPRECHPARTNER":
                                    this.st_ANSPRECHPARTNER = recent;
                                    break;
                                case "ST_WISSENSGEBIET":
                                    this.st_WISSENSGEBIET = recent;
                                    break;
                                case "TagMask":
                                    this.TagMask = recent;
                                    break;
                                case "ST_INTERESSE":
                                    help = Data.metamodel.ST_Tagged_Values.Find(x => x.Name == "ST_INTERESSE");
                                    if (recent != help.Default_Value)
                                    {
                                        this.st_INTERESSE = recent;
                                    }
                                    else
                                    {
                                        this.st_INTERESSE = Data.ST_ENUM.ST_INTERESSE[0];
                                    }
                                    
                                    break;
                                case "ST_EINFLUSS":
                                    help = Data.metamodel.ST_Tagged_Values.Find(x => x.Name == "ST_EINFLUSS");
                                    if (recent != help.Default_Value)
                                    {
                                        this.st_EINFLUSS = recent;
                                    }
                                    else
                                    {
                                        this.st_EINFLUSS = Data.ST_ENUM.ST_EINFLUSS[0];
                                    }
                                    
                                    break;
                            }
                            #endregion Zuweisung Attribute
                        }
                    }
                    else
                    {
                        flag_insert = true;
                    }
            

                    if (flag_insert == true)
                    {
                        switch (m_TV[i1].Ret[0])
                        {
                            case "UUID":
                                this.UUID = Classifier_ID;
                                this.UUID = this.UUID.Trim('{', '}');
                                m_Insert.Add(new DB_Insert("UUID", OleDbType.VarChar, OdbcType.VarChar, this.UUID, -1));
                                break;
                            case "OBJECT_ID":
                                this.OBJECT_ID = this.ID.ToString();
                                m_Insert.Add(new DB_Insert("OBJECT_ID", OleDbType.VarChar, OdbcType.VarChar, this.ID.ToString(), -1));
                                break;
                            case "ST_AG_ID":
                                this.st_AG_ID = "kein";
                                m_Insert.Add(new DB_Insert("ST_AG_ID", OleDbType.VarChar, OdbcType.VarChar, this.st_AG_ID, -1));
                                break;
                            case "ST_AN_ID":
                                this.st_AN_ID = "kein";
                                m_Insert.Add(new DB_Insert("ST_AN_ID", OleDbType.VarChar, OdbcType.VarChar, this.st_AN_ID, -1));
                                break;
                            case "ST_STAKEHOLDER":
                                this.st_STAKEHOLDER = this.Name;
                                m_Insert.Add(new DB_Insert("ST_STAKEHOLDER", OleDbType.VarChar, OdbcType.VarChar, this.st_STAKEHOLDER, -1));
                                break;
                            case "W_NUTZENDER":
                                this.w_NUTZENDER = this.Name;
                                m_Insert.Add(new DB_Insert("W_NUTZENDER", OleDbType.VarChar, OdbcType.VarChar, this.w_NUTZENDER, -1));
                                break;
                            case "ST_BESCHREIBUNG":
                                this.st_BESCHREIBUNG = this.Notes;
                                m_Insert.Add(new DB_Insert("ST_BESCHREIBUNG", OleDbType.VarChar, OdbcType.VarChar, this.Notes, -1));
                                break;
                            case "ST_ARTIKEL":
                                this.st_ARTIKEL = Data.SYS_ENUM.SYS_ARTIKEL[(int)SYS_ARTIKEL.der];
                                m_Insert.Add(new DB_Insert("ST_ARTIKEL", OleDbType.VarChar, OdbcType.VarChar, this.st_ARTIKEL, -1));
                                break;
                            case "ST_WV_PHASE":
                                this.st_WV_PHASE = Data.ST_ENUM.ST_WV_PHASE[(int)ST_WV_PHASE.phasenübergreifend];
                                m_Insert.Add(new DB_Insert("ST_WV_PHASE", OleDbType.VarChar, OdbcType.VarChar, this.st_WV_PHASE, -1));
                                break;
                            case "ST_GRUPPE":
                                this.st_GRUPPE = Data.ST_ENUM.ST_GRUPPE[(int)ST_GRUPPE.Sonstige];
                                m_Insert.Add(new DB_Insert("ST_GRUPPE", OleDbType.VarChar, OdbcType.VarChar, this.st_GRUPPE, -1));
                                break;
                            case "IN_CATEGORY":
                                this.in_CATEGORY = Data.AFO_ENUM.IN_CATEGORY[(int)IN_CATEGORY.Null];
                                m_Insert.Add(new DB_Insert("IN_CATEGORY", OleDbType.VarChar, OdbcType.VarChar, this.in_CATEGORY, -1));
                                break;
                            case "ST_AKTEUR_TYP":
                                this.st_AKTEUR_TYP = Data.ST_ENUM.ST_AKTEUR_TYP[(int)ST_AKTEUR_TYP.Human];
                                m_Insert.Add(new DB_Insert("ST_AKTEUR_TYP", OleDbType.VarChar, OdbcType.VarChar, this.st_AKTEUR_TYP, -1));
                                break;
                            case "ST_ANSPRECHPARTNER":
                                this.st_ANSPRECHPARTNER = this.Author;
                                m_Insert.Add(new DB_Insert("ST_ANSPRECHPARTNER", OleDbType.VarChar, OdbcType.VarChar, this.st_ANSPRECHPARTNER, -1));
                                break;
                            case "ST_WISSENSGEBIET":
                                this.st_WISSENSGEBIET = "kein";
                                m_Insert.Add(new DB_Insert("ST_WISSENSGEBIET", OleDbType.VarChar, OdbcType.VarChar, this.st_WISSENSGEBIET, -1));
                                break;
                            case "ST_INTERESSE":
                                this.st_INTERESSE = Data.ST_ENUM.ST_INTERESSE[(int)ST_INTERESSE.Null];
                                m_Insert.Add(new DB_Insert("ST_INTERESSE", OleDbType.VarChar, OdbcType.VarChar, this.st_INTERESSE, -1));
                                break;
                            case "ST_EINFLUSS":
                                this.st_EINFLUSS = Data.ST_ENUM.ST_EINFLUSS[(int)ST_EINFLUSS.Null];
                                m_Insert.Add(new DB_Insert("ST_EINFLUSS", OleDbType.VarChar, OdbcType.VarChar, this.st_EINFLUSS, -1));
                                break;
                            case "TagMask":
                                this.TagMask = "0";
                                m_Insert.Add(new DB_Insert("TagMask", OleDbType.VarChar, OdbcType.VarChar, this.TagMask, -1));
                                break;
                        }
                    }

                    i1++;
                } while (i1 < m_TV.Count);

                if (flag_insert == true)
                {
                    //Insert Befehl TV
                    string[] m_Input_Property = { "Object_ID", "Property", "Value", "Notes", "ea_guid" };
                    interface_TaggedValue.Insert_Tagged_Value(Data, m_Insert, tagged, this.ID, m_Input_Property);

                  //  Data.oLEDB_Interface.OLEDB_INSERT_One_Table_Multiple_TV(Data, m_Insert, tagged, "t_objectproperties", this.ID, m_Input_Property);
                }
            }
        }

        public void Update_st_reduced(Database database, EA.Repository repository)
        {
            List<Database_Connection.DB_Insert> m_Insert = new List<Database_Connection.DB_Insert>();
            m_Insert.Add(new Database_Connection.DB_Insert("ST_ARTIKEL", System.Data.OleDb.OleDbType.VarChar, System.Data.Odbc.OdbcType.VarChar, this.st_ARTIKEL, -1));
            m_Insert.Add(new Database_Connection.DB_Insert("ST_STAKEHOLDER", System.Data.OleDb.OleDbType.VarChar, System.Data.Odbc.OdbcType.VarChar, this.st_STAKEHOLDER, -1));
            m_Insert.Add(new Database_Connection.DB_Insert("W_NUTZENDER", System.Data.OleDb.OleDbType.VarChar, System.Data.Odbc.OdbcType.VarChar, this.st_STAKEHOLDER, -1));


            this.Update_TV(m_Insert, database, repository);

            EA.Element elem;

            elem = repository.GetElementByGuid(this.Classifier_ID);
            elem.Name = this.st_STAKEHOLDER;
            elem.Update();
            elem.Refresh();
        }


        }//end Stakeholder

}//end namespace Requirement_Plugin